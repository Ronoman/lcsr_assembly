<?xml version='1.0'?>
<sdf version="1.4" xmlns:xacro="http://www.ros.org/wiki/xacro" >
  <xacro:property name="pi" value="3.14159265"/>

  <xacro:macro name="gbeam_link" params="suffix pose">
    <link name="gbeam_link${suffix}">
      <pose>${pose}</pose>

      <self_collide>1</self_collide>

      <inertial>
        <mass>0.3</mass>
        <inertia>
          <ixx>0.001</ixx><ixy>0</ixy>    <ixz>0</ixz>
          <iyy>0.002</iyy><iyz>0</iyz>
          <izz>0.001</izz>
        </inertia>
      </inertial>
      <collision name='collision'>
        <geometry>
          <box>
            <size>0.05 0.3 0.05</size>
          </box>
        </geometry>
      </collision>

      <visual name='visual'>
        <geometry>
          <box>
            <size>0.05 0.3 0.05</size>
          </box>
        </geometry>
      </visual>
    </link>
  </xacro:macro>

  <xacro:macro name="gbeam_node" params="suffix pose">
    <link name="gbeam_node${suffix}">
      <pose>${pose}</pose>

      <self_collide>1</self_collide>

      <inertial>
        <mass>0.2</mass>
        <inertia>
          <ixx>0.001</ixx><ixy>0</ixy>    <ixz>0</ixz>
          <iyy>0.001</iyy><iyz>0</iyz>
          <izz>0.001</izz>
        </inertia>
      </inertial>

      <collision name='collision'>
        <geometry>
          <box>
            <size>0.05 0.05 0.05</size>
          </box>
        </geometry>
      </collision>

      <visual name='visual'>
        <geometry>
          <box>
            <size>0.05 0.05 0.05</size>
          </box>
        </geometry>
      </visual>
    </link>
  </xacro:macro>

  <model name="gbeam_soup">
    <plugin name="assembly_soup" filename="libassembly_soup_plugin.so">

      <trans_mate_err>0.01</trans_mate_err>
      <rot_mate_err>0.1</rot_mate_err>
      <tf_world_frame>world</tf_world_frame>

      <!-- Mate Models -->
      <mate_model type="gbeam">
        <!-- planar shear-supporting magnetic mate
             mating surface is along positive z-axis
             -->
        <symmetry>
          <rot>1 1 4</rot>
        </symmetry>

        <joint type="prismatic" name="gbeam">
          <pose>0 0.025 0 0 ${pi/2} 0</pose>
          <parent>gbeam_link</parent>
          <child>gbeam_node</child>
          <axis>
            <xyz>0 1 0</xyz>
            <limit><lower>-0.01</lower><upper>0.01</upper></limit>
          </axis>
          <physics>
            <ode>
              <cfm_damping>true</cfm_damping>
              <cfm>0.1</cfm>
              <erp>0.05</erp>
              <limit>
                <cfm>0.1</cfm>
                <erp>0.5</erp>
              </limit>
            </ode>
          </physics>
        </joint>
      </mate_model>

      <!-- Atom Models -->
      <atom_model type="gbeam_link">
        <mate_point type="gbeam" gender="male">
          <pose>0 0.15 0 ${pi/2} 0 ${pi}</pose>
        </mate_point>
        <!--<mate_point type="gbeam" gender="male">-->
          <!--<pose>0 -0.100 0 -${pi/2.0} 0 0</pose>-->
        <!--</mate_point>-->
      </atom_model>

      <atom_model type="gbeam_node">
        <!--<mate_point type="gbeam" gender="female">-->
          <!--<pose>0 0.025 0 ${pi/2} 0 0</pose>-->
        <!--</mate_point>-->
        <mate_point type="gbeam" gender="female">
          <pose>0 -0.025 0 ${pi/2} 0 ${pi}</pose>
        </mate_point>
        <!--<mate_point type="gbeam" gender="female">-->
          <!--<pose>0 0.05 0 -${pi/2.0} 0 0</pose>-->
        <!--</mate_point>-->
        <!--<mate_point type="gbeam" gender="female">-->
          <!--<pose>0 -0.05 0 ${pi/2.0} 0 0</pose>-->
        <!--</mate_point>-->
        <!--<mate_point type="gbeam" gender="female">-->
          <!--<pose>0.05 0 0 0 ${pi/2.0} 0</pose>-->
        <!--</mate_point>-->
        <!--<mate_point type="gbeam" gender="female">-->
          <!--<pose>-0.05 0 0 0 -${pi/2.0} 0</pose>-->
        <!--</mate_point>-->
      </atom_model>
    </plugin>

    <xacro:gbeam_node suffix="_1" pose="0 0.3 0 0 0 0"/>
    <!--<xacro:gbeam_node suffix="_2" pose="0 0 0.1 0 0 0"/>-->
    <!--<xacro:gbeam_node suffix="_3" pose="0 0 0.2 0 0 0"/>-->
    <!--<xacro:gbeam_node suffix="_4" pose="0 0 0.3 0 0 0"/>-->
    <!--<xacro:gbeam_node suffix="_5" pose="0 0 0.4 0 0 0"/>-->

    <xacro:gbeam_link suffix="_1" pose="0 0 0 0 0 0"/>
    <!--<xacro:gbeam_link suffix="_2" pose="0 0.1 0.1 0 0 0"/>-->
    <!--<xacro:gbeam_link suffix="_3" pose="0 0.1 0.2 0 0 0"/>-->
    <!--<xacro:gbeam_link suffix="_4" pose="0 0.1 0.3 0 0 0"/>-->
    <!--<xacro:gbeam_link suffix="_5" pose="0 0.1 0.4 0 0 0"/>-->
  </model>
</sdf>

